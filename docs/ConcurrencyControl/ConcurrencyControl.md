## πΊ λ™μ‹μ„± μ΄μμ™€ μ μ–΄ λ°©μ‹
> λ©μ°¨
> - λ™μ‹μ„± μ μ–΄λ°©μ‹ ν…μ¤νΈ λ° μ •λ¦¬
> - κ³Όμ  μ μ© λ°©μ‹

μ½μ„νΈ μμ•½ μ‹μ¤ν…μ—μ„ λ™μ‹μ„± μ΄μκ°€ λ°μƒν•  μ μλ” μΌ€μ΄μ¤λ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤.

1. μ½μ„νΈ μΆμ„ μμ•½: λ™μ‹μ— μ—¬λ¬λ…μ μ‚¬μ©μκ°€ κ°™μ€ μΆμ„μ„ μμ•½ν•λ ¤κ³  μ‹λ„ν•λ” κ²½μ°
2. ν¬μΈνΈ μ¶©μ „: μ‚¬μ©μκ°€ λ™μ‹μ— ν¬μΈνΈ μ¶©μ „μ„ μ§„ν–‰ν•λ” κ²½μ°
3. ν¬μΈνΈ μ‚¬μ©: μ‚¬μ©μκ°€ λ™μ‹μ— ν¬μΈνΈ μ‚¬μ©μ„ μ§„ν–‰ν•λ” κ²½μ°

λ™μ‹μ„± μ΄μλ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ λ‹¤μκ³Ό κ°™μ΄ λ‚™κ΄€μ λ½, λΉ„κ΄€μ λ½, λ¶„μ‚°λ½μ„ μ μ©ν•λ” λ°©λ²•μ„ κ³ λ ¤ν•κ³ , κ° μΌ€μ΄μ¤μ νΉμ§•μ— λ”°λΌ μ μ–΄ λ°©μ‹μ„ μ„ νƒν–μµλ‹λ‹¤.

### π“’ λ™μ‹μ„± μ μ–΄λ°©μ‹ ν…μ¤νΈ λ° μ •λ¦¬
#### 1. λ‚™κ΄€μ λ½ (s-lock, κ³µμ λ½, optimistic lock)
- νΉμ§•
    - μ½κΈ° μ κΈ ( `select ..from.. where ... for share` )μΌλ΅ ν•μ½μ΄ μ»¤λ°‹ ν•  λ• κΉμ§€ μ“°κΈ° μ κΈ.
    - s-lockμ„ μ„¤μ •ν• νΈλμ­μ…μ€ ν•΄λ‹Ή rowλ¥Ό μ½κΈ°λ§ κ°€λ¥ν•λ‹¤.
    - μ¶©λ λΉλ„κ°€ μ μ„ κ²½μ° κ¶μ¥λλ©°, λ™μ‹ μ”μ²­ μ¤‘ ν• κ±΄λ§ μ„±κ³µν•΄μ•Όν•λ” μΌ€μ΄μ¤μ— μ ν•©ν•λ‹¤.
    - versionμ„ μ‚¬μ©ν•μ—¬ μ¶©λμ„ μλ°©ν•λ©°, DB Lock μ„ μ„¤μ •ν•΄ λ™μ‹μ„± λ¬Έμ λ¥Ό μ μ–΄ν•λ” κ²ƒμ΄ μ•„λ‹λΌ μ½μ€ μ‹μ κ³Ό μμ • μ‹μ μ λ°μ΄ν„° λ³€κ²½ μ—¬λ¶€λ¥Ό ν™•μΈν•΄ μ μ–΄ν•λ” λ°©μ‹μ΄λ‹¤.
    - νΈλμ­μ…, Lock μ„¤μ • μ—†μ΄ λ°μ΄ν„° μ •ν•©μ„±μ„ λ³΄μ¥ν•  μ μμΌλ―€λ΅ λΉ„κ΄€μ  λ½λ³΄λ‹¤ μ„±λ¥μ μΌλ΅ μ°μ„μ— μλ‹¤.
- μ¥μ 
    - μ¶©λμ΄ μμ£Ό λ°μƒν•μ§€ μ•λ” κ²½μ° μ„±λ¥μ΄ μΆ‹λ‹¤.
- λ‹¨μ 
    - μ¶©λμ΄ λ°μƒν•λ©΄ λ΅¤λ°±μ— λ€ν• μ²λ¦¬κ°€ ν•„μ”ν•λ‹¤. λ°λ“μ‹ νΈλμ­μ… μ»¤λ°‹ μ‹ λ²„μ „μ΄ λ‹¬λΌ λ°μƒν•λ” μμ™Έμ— λ€ν•΄ μμ™Έμ²λ¦¬λ¥Ό ν•΄μ•Όν•λ‹¤.
- κµ¬ν„ λ³µμ΅λ„: λ‚®μ

> π€ μ„±λ¥, ν¨μ¨μ„± ν…μ¤νΈ (PointTransactionIntegrationTest.java)
>  - μ½”λ“: [PointTransactionIntegrationTest.java](..%2F..%2Fsrc%2Ftest%2Fjava%2Fcom%2Fhhplus%2Fserver%2Fdomain%2Fpayment%2FPointTransactionIntegrationTest.java)
>  - ν¬μΈνΈ μ‚¬μ©μ‹ λ™μ‹μ„± ν…μ¤νΈλ¥Ό λ‚™κ΄€μ λ½μ„ μ μ©ν•μ—¬ λ‹¤μκ³Ό κ°™μ€ μ΅°κ±΄μΌλ΅ ν…μ¤νΈ ν•΄λ³΄μ•μµλ‹λ‹¤.
>    - `USER_DEFAULT_AMOUNT = 100000`
>    - `THREAD_COUNT = 100`
>    - `USE_AMOUNT = 500`
>  - ν…μ¤νΈ κ²°κ³Ό μ•„λ μ΄λ―Έμ§€μ™€ κ°™μ΄ 100κ±΄ μ¤‘ 14κ±΄λ§ μ„±κ³µν•μ—¬ 100000 ν¬μΈνΈ μ¤‘ 93000 ν¬μΈνΈκ°€ λ‚¨μ€ κ²ƒμ„ ν™•μΈν•  μ μμ—μµλ‹λ‹¤. μ΄ κ±Έλ¦¬λ” μ‹κ°„μ€ 242ms μ€μµλ‹λ‹¤.
>    ![concurrency_test_point_use_optimistic.png](concurrency_test_point_use_optimistic.png)

#### 2. λΉ„κ΄€μ λ½ (x-lock, λ² νƒ€λ½, pessimistic lock)
- νΉμ§•
    - μ“°κΈ° μ κΈ ( `select ..from .. where... for update` )μΌλ΅ νΉμ • μμ›μ— λ€ν•΄ Lock μ„¤μ •μΌλ΅ μ„ μ ν•΄ μ •ν•©μ„±μ„ λ³΄μ¥ν•μ—¬ ν•λ‚μ νΈλμ­μ…λ§ μ½κΈ°/μ“°κΈ°κ°€ κ°€λ¥ν•κ³  λ‹¤λ¥Έ νΈλμ­μ…μ€ μ™„λ£λ  λ•κΉμ§€ λ€κΈ°ν•λ‹¤.
    - μ¶©λ λΉλ„κ°€ λ§μ„ κ²½μ° κ¶μ¥λλ©°, λ™μ‹ μ”μ²­μ—μ„ μμ°¨λ΅ μ§„ν–‰λ  λ• μ„±κ³µν•  μ μλ” μ”μ²­μ΄λΌλ©΄ μ„±κ³µμ‹ν‚¤λ” μΌ€μ΄μ¤μ— μ ν•©ν•λ‹¤.
- μ¥μ 
    - μ¶©λμ΄ μμ£Ό λ°μƒν• κ²½μ° μ λ¦¬ν•λ‹¤.
- λ‹¨μ 
    - λ€κΈ°κ°€ λ§μ•„μ§ μ μμ–΄ DB μ„±λ¥ μ €ν•μ™€ μ„λ΅ ν•„μ”ν• μμ›μ— λ½μ΄ κ±Έλ ¤μμΌλ―€λ΅ λ°λ“λ½μ΄ λ°μƒν•  μ μλ‹¤.
- κµ¬ν„ λ³µμ΅λ„: λ‚®μ

> π€ μ„±λ¥, ν¨μ¨μ„± ν…μ¤νΈ
>  - μ½”λ“: [PointTransactionIntegrationTest.java](..%2F..%2Fsrc%2Ftest%2Fjava%2Fcom%2Fhhplus%2Fserver%2Fdomain%2Fpayment%2FPointTransactionIntegrationTest.java)
>  - ν¬μΈνΈ μ‚¬μ©μ‹ λ™μ‹μ„± ν…μ¤νΈλ¥Ό λΉ„κ΄€μ λ½μ„ μ μ©ν•μ—¬ λ‹¤μκ³Ό κ°™μ€ μ΅°κ±΄μΌλ΅ ν…μ¤νΈ ν•΄λ³΄μ•μµλ‹λ‹¤. (μ„μ λ‚™κ΄€μ λ½κ³Ό λ™μΌν• μ΅°κ±΄μ…λ‹λ‹¤.)
>    - `USER_DEFAULT_AMOUNT = 100000`
>    - `THREAD_COUNT = 100`
>    - `USE_AMOUNT = 500`
>  - ν…μ¤νΈ κ²°κ³Ό μ•„λ μ΄λ―Έμ§€μ™€ κ°™μ΄ 100κ±΄ μ¤‘ 100κ±΄μ„ λ¨λ‘ μ„±κ³µν•μ—¬ 100000 ν¬μΈνΈ μ¤‘ 50000 ν¬μΈνΈκ°€ λ‚¨μ€ κ²ƒμ„ ν™•μΈν•  μ μμ—μµλ‹λ‹¤. μ΄ κ±Έλ¦¬λ” μ‹κ°„μ€ 442ms λ΅ λ€κΈ°λ¥Ό ν•λ©° λ¨λ‘ μ²λ¦¬ν•κΈ° λ•λ¬Έμ— λ‚™κ΄€μ λ½λ³΄λ‹¤ μ¤λ κ±Έλ¦° κ²ƒμ„ ν™•μΈν•  μ μμ—μµλ‹λ‹¤.
>    ![concurrency_test_point_use_pessimistic.png](concurrency_test_point_use_pessimistic.png)

#### 3. λ¶„μ‚°λ½ (Redis)
- νΉμ§•
    - λ¶„μ‚° μ‹μ¤ν…μ—μ„ μΌκ΄€λ λ½μ„ μ κ³µν•κΈ° μ„ν• κ²ƒ.
    - νΈλμ­μ… λ°–μ—μ„ λ½μ„ μ μ©ν•λ©°,  DB λ¶€ν•λ¥Ό μµμ†ν™”ν•  μ μλ‹¤.
- **β€λ λ””μ¤β€λ¥Ό ν™μ©ν• λ½μ—μ„ λ½ νλ“κ³Ό νΈλμ­μ…μ μμ„μ μ¤‘μ”μ„±**
    - λ½κ³Ό νΈλμ­μ…μ€ λ°μ΄ν„°μ λ¬΄κ²°μ„±μ„ λ³΄μ¥ν•κΈ° μ„ν•΄ μ•„λ μμ„μ— λ§κ² μν–‰λ¨μ„ λ³΄μ¥ν•΄μ•Ό ν•©λ‹λ‹¤.
        - **λ½ νλ“ β†’ νΈλμ­μ… μ‹μ‘ β†’ λΉ„μ§€λ‹μ¤ λ΅μ§ μν–‰ β†’ νΈλμ­μ… μΆ…λ£ β†’ λ½ ν•΄μ **
- μΆ…λ¥
    - simple lock
        - Lock νλ“ μ‹¤ν¨ μ‹ μ”μ²­μ— λ€ν• λΉ„μ¦λ‹μ¤ λ΅μ§μ„ μν–‰ν•μ§€ μ•λ”λ‹¤.
        - μ‹¤ν¨ μ‹ μ¬μ‹λ„ λ΅μ§μ— λ€ν•΄ κ³ λ ¤ν•΄μ•Όν•λ©° μ”μ²­μ case μ— λ”°λΌ μ‹¤ν¨ λΉλ„κ°€ λ†’λ‹¤.
    - spin lock
      <br> <img src="/docs/ConcurrencyControl/optimistic-lock.png" width="300px"/>
        - Lock νλ“ μ‹¤ν¨ μ‹, μΌμ • μ‹κ°„/νμ λ™μ• μ§€μ†μ μΈ μ¬μ‹λ„λ¥Ό ν•λ©° μ΄λ΅ μΈν• λ„¤νΈμ›ν¬ λΉ„μ© λ°μƒν•λ‹¤.
        - μ¬μ‹λ„μ— μ§€μ†μ μΌλ΅ μ‹¤ν¨ν•  μ‹, μ¤λ λ“ μ μ  λ“±μ λ¬Έμ κ°€ λ°μƒν•λ‹¤.
        - Lettuce λΌμ΄λΈλ¬λ¦¬ μ‚¬μ©
            - setnx, setex λ“±μΌλ΅ λ¶„μ‚°λ½μ„ μ§μ ‘ κµ¬ν„ν•΄μ•Όν•κ³ , retry, timeout κΈ°λ¥λ„ κµ¬ν„ν•΄μ•Όν•λ‹¤.
            - μ¬μ‹λ„λ¥Ό ν•κΈ° λ•λ¬Έμ— λ λ””μ¤μ— λ¶€ν•λ¥Ό μ¤„ μ μλ‹¤.
    - pub/sub
      <br> <img src="/docs/ConcurrencyControl/redis-pubsub.png" width="300px"/>
        - λ λ””μ¤ Pub/Sub κΈ°λ¥μ„ ν™μ©ν•΄ λ½ νλ“μ„ μ‹¤ν¨ ν–μ„ μ‹μ—, β€κµ¬λ…β€ ν•κ³  μ°¨λ΅€κ°€ λ  λ•κΉμ§€ μ΄λ²¤νΈλ¥Ό κΈ°λ‹¤λ¦¬λ” λ°©μ‹μ„ μ΄μ©ν•΄ ν¨μ¨μ μΈ Lock κ΄€λ¦¬κ°€ κ°€λ¥ν•λ‹¤.
        - β€κµ¬λ…β€ ν• subscriber λ“¤ μ¤‘ λ¨Όμ € μ„ μ ν• μ‘μ—…λ§ Lock ν•΄μ κ°€ κ°€λ¥ν•λ―€λ΅ μ•μ •μ μΌλ΅ μ›μμ  μ²λ¦¬κ°€ κ°€λ¥ν•λ‹¤.
        - μ§μ ‘ κµ¬ν„, νΉμ€ λΌμ΄λΈλ¬λ¦¬λ¥Ό μ΄μ©ν•  λ• ν•΄λ‹Ή λ°©μ‹μ κµ¬ν„μ΄ λ‹¬λΌμ§ μ μμΌλ―€λ΅ μ£Όμν•΄μ„ μ‚¬μ©ν•΄μ•Ό ν•λ‹¤.
        - Redisson λΌμ΄λΈλ¬λ¦¬ μ‚¬μ©
            - subscribe ν•λ” ν΄λΌμ΄μ–ΈνΈλ” λ½μ΄ ν•΄μ λμ—λ‹¤λ” μ‹ νΈλ¥Ό λ°›κ³  λ½ νλ“μ„ μ‹λ„ν•λ‹¤.
- κµ¬ν„ λ³µμ΅λ„: λ†’μ

> π¨ Redisson λΌμ΄λΈλ¬λ¦¬ μ‚¬μ©μ‹ μ£Όμμ 
> - μ°Έκ³ μλ£
>  - https://redis.io/docs/latest/develop/use/patterns/distributed-locks/
>  - https://martin.kleppmann.com/2016/02/08/how-to-do-distributed-locking.html
> - Redis κ³µμ‹ λ¬Έμ„λ¥Ό λ³΄λ©΄ λ¶„μ‚°λ½μ„ μ„ν•΄ RedLock μ•κ³ λ¦¬μ¦μ„ μ‚¬μ©ν•©λ‹λ‹¤. RedLockμ„ Javaμ—μ„ μ‚¬μ©ν•  μ μλ„λ΅ κµ¬ν„ν• κ²ƒμ΄ Redisson λΌμ΄λΈλ¬λ¦¬ μ…λ‹λ‹¤.
> - RedLock μ•κ³ λ¦¬μ¦μ€ λ¶„μ‚° ν™κ²½μ—μ„ λ‹¤μκ³Ό κ°™λ‹¤κ³  κ°€μ •ν•©λ‹λ‹¤.
>   - λ‹¨μΌ Redis μΈμ¤ν„΄μ¤ λ€μ‹  Nκ°μ λ…λ¦½μ μΈ Redis λ§μ¤ν„°λ¥Ό μ‚¬μ© (μΌλ°μ μΌλ΅ N=5)
>   - κ³Όλ°μ(N/2+1) μ΄μƒμ Redis μΈμ¤ν„΄μ¤μ—μ„ λ½μ„ νλ“ν•΄μ•Ό μ ν¨ν• κ²ƒμΌλ΅ κ°„μ£Ό
> - Redis κ³µμ‹ λ¬Έμ„μ—μ„λ” λ‹¤μκ³Ό κ°™μ€ λ¬Έμ κ°€ λ°μƒν•  μ μλ‹¤κ³  ν•©λ‹λ‹¤.
>   1. μ‹μ¤ν… ν΄λ΅μ— μν• clock drift ν„μƒ
>      - Redisλ” TTL λ§λ£λ¥Ό μ„ν•΄ monotonic clock λ¥Ό μ‚¬μ©ν•μ§€ μ•μµλ‹λ‹¤.
>      - μ„λ²„μ μ‹κ°„μ΄ κ°‘μκΈ° λ³€κ²½λ  κ²½μ°, μ—¬λ¬ ν”„λ΅μ„Έμ¤κ°€ λ™μ‹μ— λ½μ„ νλ“ν•  μ μμµλ‹λ‹¤.
>   2. μ„λ²„ λ‹¤μ΄, λ„¤νΈμ›ν¬ λ‹¨μ , ν”„λ΅μ„Έμ¤ μ‹¤ν–‰ μ‹κ°„ μ΄κ³Όμ‹ λ™μ‹μ„± λ¬Έμ 
>      - λ‹¤μκ³Ό κ°™μ€ κ²½μ° μ•μ „μ„± λ³΄μ¥μ΄ λ¶κ°€λ¥ν•©λ‹λ‹¤.
>        - Redis μ„λ²„κ°€ λ‹¤μ΄ λμ—λ‹¤κ°€ λ³µκµ¬ λμ—μ„ κ²½μ°
>        - Redis μ„λ²„λ” μ •μƒμ΄λ‚, λ„¤νΈμ›ν¬ λ¬Έμ λ΅ μΌλ¶€ ν΄λΌμ΄μ–ΈνΈμ™€ ν†µμ‹ μ΄ λκ²¨ λ½μ„ λ³΄μ ν• ν΄λΌμ΄μ–ΈνΈκ°€ λ½μ„ ν•΄μ ν•μ§€ λ»ν•λ” κ²½μ°
>        - λ½μ„ λ³΄μ ν• ν”„λ΅μ„Έμ¤κ°€ TTLλ³΄λ‹¤ μ¤λ μ‹¤ν–‰λ  κ²½μ°
>      - μ΄λ¥Ό μ„ν• ν•΄κ²°μ±…μΌλ΅ fencing token κµ¬ν„μ΄ ν•„μ”ν•©λ‹λ‹¤.
>        - λ™μ‹μ„± λ¬Έμ 
>          <br> <img src="/docs/ConcurrencyControl/redisson1.png" width="400px"/>
>        - fencing token μ‚¬μ©μ‹
>          <br> <img src="/docs/ConcurrencyControl/redisson2.png" width="400px"/>

#### 4. **Kafka Messaging**
<img src="/docs/ConcurrencyControl/kafka-messaging.png" width="400px"/>

- νΉμ§•
    - Queue μ μ„±μ§μ„ μ΄μ©ν•μ—¬ μ²λ¦¬ μμ„λ¥Ό λ³΄μ¥ν•΄ νΉμ • λ°μ΄ν„°μ— λ€ν• λ™μ‹μ„± λ¬Έμ κ°€ λ°μƒν•μ§€ μ•λ”λ‹¤.
    - λ‹¨, λ³€κ²½ κ°μ§€μ— λ€ν• λ¶€λ¶„μ΄ ν•„μ”ν•λ‹¤. (λΉ„λ™κΈ° μ²λ¦¬κ°€ λλ―€λ΅ μ²λ¦¬ κ²°κ³Όλ¥Ό λ°”λ΅ ν™•μΈν•  μ μ—†μ)
    - ex) μ£Όλ¬Έ λ‚΄, μƒν’λ³„ μ‹¤ν¨μ‹ μ²λ¦¬ λ°©λ²•
- κµ¬ν„ λ³µμ΅λ„: λ†’μ

### π“’ κ³Όμ  μ μ© λ°©μ‹
μ½μ„νΈ μμ•½ μ„λΉ„μ¤μ—μ„ λ°μƒν•  μ μλ” λ™μ‹μ„± λ¬Έμ μ— λ€ν•΄ λ‹¤μκ³Ό κ°™μ΄ ν•΄κ²°ν•  μ μλ‹¤κ³  νλ‹¨ν•μ€μµλ‹λ‹¤.

#### 1. μ½μ„νΈ μΆμ„ μμ•½
- μ μ ν• λ°©λ²•: λ¶„μ‚°λ½(pub/sub) > λΉ„κ΄€μ λ½ > λ‚™κ΄€μ λ½
- μ„ νƒν• λ°©λ²•: λ¶„μ‚°λ½(pub/sub) + λ‚™κ΄€μ λ½
- μ„ νƒ μ΄μ 
    - μ½μ„νΈ μλ§¤λ” λ™μ‹μ— μ ‘μ†μκ°€ λ§κΈ° λ•λ¬Έμ— μ¶©λμ΄ λ§μ΄ λ°μƒν•  μ μμ–΄ λ™μ‹μ„± μ΄μκ°€ λ°μƒν•  κ°€λ¥μ„±μ΄ λ†’μµλ‹λ‹¤.
    - κ·Έλ¦¬κ³  μ—¬λ¬ μ„λ²„λ¥Ό μ‚¬μ©ν•  κ²½μ° λ¶„μ‚° ν™κ²½μ—μ„ λ™μ‹μ„± μ μ–΄κ°€ ν•„μ”ν•©λ‹λ‹¤.
    - λ¶„μ‚° ν™κ²½μ—μ„ λ™μ‹μ„± μ μ–΄μ™€ DBμ λ¶€ν•λ¥Ό μ¤„μ΄κΈ° μ„ν•΄μ„λ” λ¶„μ‚°λ½μ΄ κ°€μ¥ μ μ ν•λ‹¤κ³  μƒκ°μ΄ λμ—μµλ‹λ‹¤. κ·Έ λ°©μ‹μΌλ΅λ” μ½μ„νΈ μλ§¤ μ‹¤ν¨ μ‹μ— retryλ¥Ό ν•  ν•„μ”κ°€ μ—†μΌλ―€λ΅ pub/sub λ°©μ‹μ΄ μ μ ν•λ‹¤κ³  μƒκ°ν•©λ‹λ‹¤.
    - κ·Έλ¦¬κ³  Redissonμ„ μ‚¬μ©ν•μ—¬ κµ¬ν„ν•  κ²½μ°, λ°μƒν•  μ λ°μƒν•  μ μλ” λ¬Έμ μ— λ€ν•΄ μ½μ„νΈ μΆμ„ μλ§¤μ νΉμ„±μƒ β€λ‚™κ΄€μ λ½β€™μ„ μ¶”κ°€λ΅ μ μ©ν•μ—¬ λ³΄μ™„ν•  μ μμµλ‹λ‹¤.
    - λ³΄μ™„ λ°©λ²•μΌλ΅ λΉ„κ΄€μ λ½μ΄ μ•„λ‹ λ‚™κ΄€μ λ½μ„ μ„ νƒν• μ΄μ λ” λ¶„μ‚°λ½μ„ μ‚¬μ©ν•κΈ° λ•λ¬Έμ— μ¶©λμ΄ λ°μƒν•  κ°€λ¥μ„±μ΄ μ κ³  λΉ„κ΄€μ λ½λ³΄λ‹¤ λ‚™κ΄€μ λ½μ΄ λΉ λ¥΄κ² μ²λ¦¬ν•  μ μκΈ° λ•λ¬Έμ…λ‹λ‹¤.
    - Fencing token λ€μ‹  λ‚™κ΄€μ  λ½μ„ μ‚¬μ©ν• μ΄μ λ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤.
        - λΉ λ¥Έ μ²λ¦¬ μ‹κ°„ : μμ•½ μ²λ¦¬λ” λΉ„κµμ  λ‹¨μν•κ³  λΉ λ¥Έ μ‘μ—…μ…λ‹λ‹¤. μ¶”κ°€μ μΈ ν† ν° κ΄€λ¦¬μ™€ μ¤λ²„ν—¤λ“κ°€ λ¶ν•„μ”ν•©λ‹λ‹¤.
        - μ¶©λ¶„ν• μ•μ „μ„±: λ¶„μ‚°λ½μΌλ΅ 1μ°¨ λ°©μ–΄λ¥Ό ν•κ³  λ‚™κ΄€μ  λ½μΌλ΅ 2μ°¨ λ°©μ–΄λ¥Ό ν•λ” κ²ƒμΌλ΅ μ¶©λ¶„ν• μ•μ „μ„±μ„ ν™•λ³΄ν•  μ μμµλ‹λ‹¤.
        - μ‹¤ν¨ μ²λ¦¬μ λ‹¨μν•¨: μμ•½ μ‹¤ν¨ μ‹ μ‚¬μ©μμ—κ² λΉ λ¥Έ ν”Όλ“λ°±μ΄ κ°€λ¥ν•λ©° μ¬μ‹λ„κ°€ λ°μƒν•λ”λΌλ„ μ‚¬μ©μ κ²½ν—μ— ν¬κ² μν–¥μ΄ μ—†μµλ‹λ‹¤.
        - μ΄μ κ΄€μ μ λ‹¨μν•¨: ν† ν° κ΄€λ¦¬λ‚ μ¶”κ°€ μΈν”„λΌ λ¶ν•„μ”ν•λ©° λ¨λ‹ν„°λ§μ΄ λΉ„κµμ  κ°„λ‹¨ν•©λ‹λ‹¤.
    - μ¶”κ°€λ΅ Redisλ¥Ό μ‚¬μ©ν•  κ²½μ° μ¶”κ°€μ μΈ μΈν”„λΌλ¥Ό μ‚¬μ©ν•΄μ•Ό ν•κΈ° λ•λ¬Έμ— ν„μ¬ λ¶„μ‚°λ½μ„ μ‚¬μ©ν•μ§€ μ•λ”λ‹¤λ©΄, λΉ„κ΄€μ  λ½μ„ μ μ©ν•λ” κ²ƒμ΄ μ μ ν•λ‹¤κ³  μƒκ°ν•©λ‹λ‹¤. κ°™μ€ μΆμ„μ„ μμ•½ν•λ”λ° λ™μ‹μ— μ¶©λμ΄ λ§μ΄ λ°μƒν•  μ μκΈ° λ•λ¬Έμ— λ°μ΄ν„° μ •ν•©μ„±μ„ μ μ§€ν•  μ μμµλ‹λ‹¤. ν„μ¬ λ¶„μ‚° DBλ¥Ό μ‚¬μ©ν•μ§€ μ•κΈ° λ•λ¬Έμ— λΉ„κ΄€μ λ½μΌλ΅ μ¶©λ¶„ν κ°€λ¥ν•λ‹¤κ³  μƒκ°μ΄ λμ—μ§€λ§, λ¶„μ‚°λ½ μ μ©μ„ μ‹λ„ν•΄λ³΄μ•μµλ‹λ‹¤.

#### 2. ν¬μΈνΈ μ¶©μ „
- μ μ ν• λ°©λ²•: λ‚™κ΄€μ λ½ > λΉ„κ΄€μ λ½ > λ¶„μ‚°λ½
- μ„ νƒν• λ°©λ²•: λ‚™κ΄€μ λ½
- μ„ νƒ μ΄μ 
    - ν¬μΈνΈ μ¶©μ „μ„ λ™μ‹μ— μ”μ²­ν•λ” μΌ€μ΄μ¤λ” κ±°μ μ—†μΌλ―€λ΅, μ¶©λμ΄ μ λ°μƒν•μ§€ μ•μµλ‹λ‹¤.
    - λ™μ‹ μ”μ²­μ— λ€ν•΄ ν•λ‚λ§ μ„±κ³µν•΄λ„ λλ©° μλ» λ λ™μ‹ μ”μ²­ μ²λ¦¬μ— λ€ν• λ¬Έμ λ¥Ό λ°©μ§€ν•  μ μμµλ‹λ‹¤.
    - μ΄μ— λ”°λΌ retryλ¥Ό ν•κ±°λ‚ νΈλμ­μ…μ΄ λ€κΈ°ν•μ§€ μ•μ•„λ„ λλ‹¤κ³  μƒκ°λμ—κ³  λ™μ‹μ„±μ΄ λ‚®μ„ κ²½μ° μ„±λ¥μ΄ μΆ‹μ€ λ‚™κ΄€μ λ½μ΄ μ μ ν•λ‹¤κ³  νλ‹¨λμ—μµλ‹λ‹¤.

#### 3. ν¬μΈνΈ μ‚¬μ©
- μ μ ν• λ°©λ²•: λΉ„κ΄€μ λ½ > λ¶„μ‚°λ½ > λ‚™κ΄€μ λ½
- μ„ νƒν• λ°©λ²•: λΉ„κ΄€μ λ½
- μ„ νƒ μ΄μ 
    - λ™μ‹μ— μ—¬λ¬ μ½μ„νΈμ μΆμ„μ„ κ²°μ  μ”μ²­ν•  μ μλ”λ° μ΄ κ²½μ° μ „λ¶€ μ²λ¦¬κ°€ λμ–΄μ•Ό ν•©λ‹λ‹¤.
    - μ•μ „ν•κ² μ²λ¦¬ν•κ³  userμ— λ€ν• λ°μ΄ν„°μ— μ ‘κ·Όν•λ” λ¶€ν•λ¥Ό μ¤„μ΄κΈ° μ„ν•΄ λΉ„κ΄€μ λ½μ΄ μ μ ν•λ‹¤κ³  νλ‹¨λμ—μµλ‹λ‹¤

